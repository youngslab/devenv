# ~/.claude/commands/commit.md

---
description: "[AUTO-INVOKE] Use this skill whenever user requests a commit. Analyzes changes, generates commit message, and commits after confirmation."
allowed-tools: Bash(git diff:*), Bash(git status:*), Bash(git add:*), Bash(git commit:*), Bash(git log:*), Read
argument-hint: [type] [scope]
---

## Context
- Staged changes: !`git diff --staged --stat`
- Unstaged changes: !`git diff --stat`
- Current status: !`git status --short`
- Recent commits (reference): !`git log --oneline -5`

## Task

### Step 1: Analyze Changes
1. Check `git diff --staged`
2. If no staged files, show `git status` and ask which files to stage
3. Summarize the changes

### Step 2: Generate Commit Message
Use Conventional Commits format:
```
<type>(<scope>): <subject>

<body>
```

#### Type (use argument if provided)
- feat: New feature
- fix: Bug fix
- docs: Documentation changes
- style: Formatting (no code changes)
- refactor: Code refactoring
- test: Add/modify tests
- chore: Build, config changes

#### Rules
- subject: Max 50 chars, imperative mood, lowercase
- body: Wrap at 72 chars, explain what & why (optional)
- Always english

### Step 3: User Confirmation
Present in this format:
```
## üìã Changes
[File list and summary of key changes]

## üí¨ Suggested Commit Message

feat(auth): implement token refresh logic

- Add automatic refresh before expiration
- Handle refresh failure gracefully

---
‚ö° Options:
- "commit" or "Y" ‚Üí Commit with this message
- "edit: ..." ‚Üí Modify message and confirm again
- "cancel" ‚Üí Abort commit
```

### Step 4: Execute Commit (on approval only)
```bash
git commit -m "message"
```

Or with body:
```bash
git commit -m "subject" -m "body"
```

## ‚ö†Ô∏è Restrictions
- NEVER use `--signoff` flag
- NEVER include "Generated by", "Co-authored-by: Claude", "AI", or any AI-related mentions
- NEVER commit without user confirmation
- NEVER stage files without asking first

## Argument Handling
- `$1` (type): feat, fix, docs, etc. ‚Üí Use as commit type
- `$2` (scope): Use as scope if provided

Examples:
- `/commit` ‚Üí Auto-analyze
- `/commit fix` ‚Üí Use fix type
- `/commit feat auth` ‚Üí feat(auth): ...
