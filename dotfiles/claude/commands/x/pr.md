# ~/.claude/commands/pr.md

---
description: "[AUTO-INVOKE] Use this skill whenever user requests a PR. Analyzes commits, generates PR title/body, and creates PR after confirmation."
allowed-tools: Bash(git diff:*), Bash(git status:*), Bash(git log:*), Bash(git branch:*), Bash(git remote:*), Bash(gh pr:*), Bash(gh repo:*), Read
argument-hint: [base-branch]
---

## Context
- Current branch: !`git branch --show-current`
- Remote tracking: !`git rev-parse --abbrev-ref --symbolic-full-name @{u} 2>/dev/null || echo "No upstream"`
- Commits ahead: !`git log --oneline @{u}..HEAD 2>/dev/null || git log --oneline -10`
- Changed files: !`git diff --stat @{u}..HEAD 2>/dev/null || git diff --stat main..HEAD 2>/dev/null`

## Task

### Step 1: Validate State
1. Check if on a feature branch (not main/master)
2. Check if there are commits to push
3. Identify base branch (argument or default: main)
4. Check if remote branch exists, push if needed

### Step 2: Analyze Changes
1. Review all commits: `git log --oneline <base>..HEAD`
2. Review full diff: `git diff <base>..HEAD --stat`
3. Summarize the changes by category (features, fixes, refactors, etc.)

### Step 3: Generate PR Content
#### Title Format
```
[TICKET-ID] Concise description
```
- Extract ticket ID from branch name if possible (e.g., `feature/PROJ-123-desc` â†’ `[PROJ-123]`)
- If no ticket ID, omit brackets
- Max 72 characters

#### Body Format (Markdown)
```markdown
## Summary
[1-3 bullet points describing what this PR does]

## Changes
[List of key changes organized by category]

## Test Plan
[How to test these changes]
```

### Step 4: User Confirmation
Present in this format:
```
## ğŸ¯ PR Preview

**Base:** main â† **Head:** feature/my-branch
**Commits:** 3 commits

## ğŸ“ Title
[PROJ-123] Add user authentication flow

## ğŸ“„ Body
[Generated body content]

---
âš¡ Options:
- "create" or "Y" â†’ Create PR with this content
- "draft" â†’ Create as draft PR
- "edit title: ..." â†’ Modify title
- "edit body: ..." â†’ Modify body
- "cancel" â†’ Abort PR creation
```

### Step 5: Execute PR Creation (on approval only)
```bash
gh pr create --title "title" --body "body" --base <base-branch>
```

For draft PR:
```bash
gh pr create --title "title" --body "body" --base <base-branch> --draft
```

### Step 6: Post-Creation
1. Display the PR URL
2. Offer to open in browser: `gh pr view --web`

## âš ï¸ Restrictions
- NEVER create PR without user confirmation
- NEVER force push or modify commit history
- NEVER include "Generated by AI", "Co-authored-by: Claude", or any AI-related mentions
- NEVER create PR from main/master branch
- Maximum 100 lines for PR body

## Argument Handling
- `$1` (base-branch): Target branch for PR (default: main)

Examples:
- `/pr` â†’ Create PR to main
- `/pr develop` â†’ Create PR to develop branch
- `/pr release/v2` â†’ Create PR to release/v2 branch
